<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HELPSY | –í–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&display=swap" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Toastr CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body class="d-flex flex-column min-vh-100">

    <!-- HEADER -->
    <header class="shadow z-3">
        <nav class="navbar navbar-expand-md py-4 navbar-dark-text">
            <div class="container-xl px-4 px-sm-5 px-lg-4">
                <div class="navbar-brand d-flex flex-column py-0">
                    <span class="uk-logo">Helpsy</span>
                    <span class="uk-logo-sub d-none d-sm-block">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤–∞—à–æ–≥–æ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤'—è</span>
                </div>
                <button class="navbar-toggler p-2 rounded" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <svg class="h-6 w-6" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto mb-2 mb-md-0 align-items-md-center">
                        <li class="nav-item">
                            <a class="nav-link btn fw-bold px-4 py-2 text-white rounded" href="#consultation">
                                –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è –ª—ñ–∫–∞—Ä—è –æ–Ω–ª–∞–π–Ω
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow-1 w-100 py-5">
        <div class="container-lg px-4 mx-auto" style="max-width: 760px;">

            <!-- –¢–µ—Å—Ç–æ–≤–∞ —Ñ–æ—Ä–º–∞ -->
            <section class="mt-5 mb-5">
                <div class="container">
                    <div class="p-5 rounded-4 bg-white shadow-lg">

                        <header class="text-center my-5">
                            <h1 class="fs-1 fw-semibold text-dark mb-4">
                                <i class="bi bi-clipboard-check text-primary me-2"></i>–¶–µ–Ω—Ç—Ä —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
                            </h1>
                            <p class="text-muted fs-6 mx-auto" style="max-width: 700px; line-height: 1.6;">
                                –ü—Ä–æ–π–¥—ñ—Ç—å –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω—ñ —Ç–µ—Å—Ç–∏ —Ç–∞ –æ—Ç—Ä–∏–º–∞–π—Ç–µ
                                <strong class="text-primary fw-semibold">–ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</strong> —ñ
                                <strong class="text-primary fw-semibold">–∫–æ—Ä–∏—Å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</strong> –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –≤–∞—à–æ–≥–æ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤‚Äô—è.
                            </p>
                        </header>

                        <form id="contact-form" class="mx-auto" style="max-width:700px;">
                            <div class="row g-4">
                                <div class="col-12">
                                    <input type="text" id="last_name" name="last_name" required
                                        class="form-control form-control-lg rounded-4" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ">
                                </div>
                                <div class="col-12">
                                    <input type="text" id="first_name" name="first_name" required
                                        class="form-control form-control-lg rounded-4" placeholder="–Ü–º'—è">
                                </div>
                                <div class="col-12">
                                    <input type="email" id="email" name="email" required
                                        class="form-control form-control-lg rounded-4" placeholder="Email">
                                </div>
                                <div class="col-12">
                                    <input type="tel" id="phone-input" name="phone" required
                                        class="form-control form-control-lg rounded-4" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                                </div>

                                <div class="col-md-6">
                                    <label for="dob" class="form-label small">–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è</label>
                                    <input type="date" id="dob" name="dob" required
                                        class="form-control form-control-lg rounded-4">
                                </div>

                                <div class="col-md-6">
                                    <label for="gender" class="form-label small">–°—Ç–∞—Ç—å</label>
                                    <select id="gender" name="gender" required
                                        class="form-select form-select-lg rounded-4">
                                        <option value="" disabled selected hidden>–û–±–µ—Ä—ñ—Ç—å</option>
                                        <option value="male">–ß–æ–ª–æ–≤—ñ—á–∞</option>
                                        <option value="female">–ñ—ñ–Ω–æ—á–∞</option>
                                        <option value="other">–Ü–Ω—à–∞</option>
                                    </select>
                                </div>

                                <div class="col-12">
                                    <label for="concern" class="form-label small">–©–æ –í–∞—Å —Ç—É—Ä–±—É—î?</label>
                                    <select id="concern" name="concern" required
                                        class="form-select form-select-lg rounded-4">
                                        <option value="" disabled selected hidden>–û–±–µ—Ä—ñ—Ç—å</option>
                                        <option value="–¥–µ–ø—Ä–µ—Å—ñ—è">–î–µ–ø—Ä–µ—Å—ñ—è</option>
                                        <option value="—Ç—Ä–∏–≤–æ–∂–Ω—ñ—Å—Ç—å">–¢—Ä–∏–≤–æ–∂–Ω—ñ—Å—Ç—å</option>
                                        <option value="–ø—Ç—Å—Ä">–ü–¢–°–†</option>
                                        <option value="—Å–¥–≤–≥">–°–î–í–ì</option>
                                        <option value="—Å—Ç—Ä–µ—Å">–°—Ç—Ä–µ—Å</option>
                                        <option value="–ø—Ä–æ–±–ª–µ–º–∏_–∑—ñ_—Å–Ω–æ–º">–ü—Ä–æ–±–ª–µ–º–∏ –∑—ñ —Å–Ω–æ–º</option>
                                        <option value="—Ä–æ–∑–ª–∞–¥–∏_—Ö–∞—Ä—á–æ–≤–æ—ó_–ø–æ–≤–µ–¥—ñ–Ω–∫–∏">–†–æ–∑–ª–∞–¥–∏ —Ö–∞—Ä—á–æ–≤–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏</option>
                                        <option value="–ø—Ä–æ–±–ª–µ–º–∏_–∑_–∞–ª–∫–æ–≥–æ–ª–µ–º_—á–∏_–Ω–∞—Ä–∫–æ—Ç–∏–∫–∞–º–∏">–ü—Ä–æ–±–ª–µ–º–∏ –∑ –∞–ª–∫–æ–≥–æ–ª–µ–º/–Ω–∞—Ä–∫–æ—Ç–∏–∫–∞–º–∏</option>
                                        <option value="—Å–∫–ª–∞–¥–Ω–æ—â—ñ_—É_—Å—Ç–æ—Å—É–Ω–∫–∞—Ö">–°–∫–ª–∞–¥–Ω–æ—â—ñ —É —Å—Ç–æ—Å—É–Ω–∫–∞—Ö</option>
                                        <option value="–Ω–∏–∑—å–∫–∞_—Å–∞–º–æ–æ—Ü—ñ–Ω–∫–∞">–ù–∏–∑—å–∫–∞ —Å–∞–º–æ–æ—Ü—ñ–Ω–∫–∞</option>
                                        <option value="–µ–º–æ—Ü—ñ–π–Ω–µ_–≤–∏–≥–æ—Ä–∞–Ω–Ω—è">–ï–º–æ—Ü—ñ–π–Ω–µ –≤–∏–≥–æ—Ä–∞–Ω–Ω—è</option>
                                        <option value="—ñ–Ω—à–µ">–Ü–Ω—à–µ</option>
                                    </select>
                                </div>

                                <div class="col-12 my-5">
                                    <select id="test_type" name="test_type" required
                                        class="form-select form-select-lg rounded-4 fw-bold test-selector-highlight">
                                        <option value="" disabled selected hidden>‚≠êÔ∏è –û–±–µ—Ä—ñ—Ç—å —Ç–µ—Å—Ç</option>
                                        <option value="PHQ9">PHQ-9</option>
                                        <option value="GAD7">GAD-7</option>
                                        <option value="BDI2">BDI-II</option>
                                        <option value="HADS">HADS</option>
                                        <option value="BAI">BAI</option>
                                        <option value="BST">BST</option>
                                        <option value="ASRS">ASRS</option>
                                        <option value="ITQ">ITQ</option>
                                    </select>
                                </div>

                                <div class="col-12 my-3">
                                    <div class="g-recaptcha" data-sitekey="YOUR_SITE_KEY"></div>
                                </div>

                                <div class="col-12 mt-4">
                                    <div class="form-check mb-4">
                                        <input class="form-check-input" type="checkbox" id="consent" name="consent"
                                            checked disabled>
                                        <label class="form-check-label text-secondary small" for="consent">
                                            –Ø –ø–æ–≥–æ–¥–∂—É—é—Å—å –∑ <a href="<?= appUrl ?>?page=pp" class="text-primary">–ü–æ–ª—ñ—Ç–∏–∫–æ—é –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ</a>
                                        </label>
                                    </div>
                                    <button type="submit" id="submit-button"
                                        class="btn btn-primary btn-lg w-100 rounded-pill fw-bold py-3">
                                        –†–æ–∑–ø–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç
                                    </button>
                                </div>

                                <div class="col-12 mt-3">
                                    <p class="bg-light text-muted small rounded-4 p-3 text-center d-flex align-items-center justify-content-center gap-2">
                                        <i class="bi bi-lock-fill me-1"></i>
                                        –ö–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ. –í–∞—à—ñ –¥–∞–Ω—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –ª–∏—à–µ –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.
                                    </p>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div id="statusBanner" class="mt-3 text-center fw-semibold" style="display:none;"></div>
                </div>
            </section>

            <!-- –û–ø–∏—Å —Ç–∞ FAQ -->
            <section class="mt-5 mb-5">
                <div class="container">
                    <div class="p-5 rounded-4 bg-white shadow-sm border border-light text-center">
                        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–µ–∫, FAQ –∏ —Ç–µ—Å—Ç—ã –±–µ–∑ inline —Å—Ç–∏–ª–µ–π -->
                        <!-- –î–æ–±–∞–≤—å—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤–∞—à–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ -->
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Spinner -->
    <div id="loadingSpinner"></div>

    <!-- FOOTER -->
    <footer class="bg-dark mt-auto py-5">
        <div class="container-xl px-4 px-sm-5 px-lg-4">
            <!-- Footer content –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤–∞—à–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ -->
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/inputmask/dist/inputmask.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>

    <script>
        $(document).ready(function () {
            Inputmask({ mask: "38(999)9999999", placeholder: "_", showMaskOnHover: false, showMaskOnFocus: true })
                .mask("#phone-input");
        });
    </script>

    <script>
let fingerprint = "";

// –ü–æ–ª—É—á–∞–µ–º fingerprint
(async () => {
    const fp = await FingerprintJS.load();
    const result = await fp.get();
    fingerprint = result.visitorId;
})();

function generateUUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}

function getUrlParams() {
    const params = {};
    const searchParams = new URLSearchParams(window.location.search);
    for (const [key, value] of searchParams.entries()) {
        params[key] = value;
    }
    return params;
}

$("#contact-form").on("submit", async function(e) {
    e.preventDefault();
    const form = this;
    const $button = $("#submit-button");
    const $spinner = $("#loadingSpinner");

    $spinner.show();
    $button.prop("disabled", true);

    const urlParams = getUrlParams();
    const testId = generateUUID();

    const formData = new FormData(form);
    const dataObj = {};
    formData.forEach((value, key) => {
        dataObj[key] = value || "";
    });

    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è
    dataObj["testId"] = testId;
    dataObj["leadid"] = urlParams["leadid"] || "";
    dataObj["test_type"] = $("#test_type").val() || "";
    dataObj["consent"] = "on";
    dataObj["utm_source"] = urlParams["utm_source"] || "";
    dataObj["utm_medium"] = urlParams["utm_medium"] || "";
    dataObj["utm_campaign"] = urlParams["utm_campaign"] || "";
    dataObj["utm_term"] = urlParams["utm_term"] || "";
    dataObj["utm_content"] = urlParams["utm_content"] || "";
    dataObj["host"] = window.location.host;
    dataObj["referer"] = document.referrer;
    dataObj["system"] = navigator.platform;
    dataObj["userAgent"] = navigator.userAgent;
    dataObj["language"] = navigator.language || navigator.userLanguage;
    dataObj["fingerprint"] = fingerprint;

    // –ü–æ–ª—É—á–∞–µ–º IP
    try {
        const ipResp = await fetch("https://api.ipify.org?format=json");
        const ipData = await ipResp.json();
        dataObj["user_ip"] = ipData.ip || "";
    } catch {
        dataObj["user_ip"] = "";
    }

    const LAMBDA_URL = "https://service.nexson.space/psytests/reg";

    $.ajax({
        url: LAMBDA_URL,
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify(dataObj),
        success: function(responseText) {
            let result;
            try {
                // üîπ –ï—Å–ª–∏ Lambda –≤–µ—Ä–Ω—É–ª–∞ JSON —Å–æ —Å—Ç—Ä–æ–∫–æ–π –≤ body:
                if (typeof responseText === "string") {
                    responseText = JSON.parse(responseText);
                }
                result = typeof responseText.body === "string"
                    ? JSON.parse(responseText.body)
                    : responseText.body || responseText;
            } catch (e) {
                console.error("JSON parse error:", e);
                result = { success: false, message: "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞" };
            }

            // üîπ –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            if (result.success) {
                toastr.success(result.message || "–§–æ—Ä–º–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞", "–£—Å–ø–µ—Ö!");
                form.reset();
                window.location.href = "thank_you_page.html";
            } else {
                toastr.error(result.message || "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ", "–û—à–∏–±–∫–∞!");
            }
        },
        error: function(xhr, status, error) {
            toastr.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã", "–û—à–∏–±–∫–∞!");
            console.error("AJAX Error:", status, error);
        },
        complete: function() {
            $spinner.hide();
            $button.prop("disabled", false);
        }
    });
});
</script>
</body>

</html>